#!/bin/bash

# loosely based on
# http://repos.archlinux.org/viewvc.cgi/wicd/repos/extra-i686/wicd-daemon?revision=1&view=markup
# and modified to use the PIDFILE

. /etc/rc.conf
. /etc/rc.d/functions

# This is defined in /usr/lib/python2.5/site-packages/wicd/wpath.py
PIDFILE="%PIDFILE%"

wicd_start() {
  stat_busy "Starting wicd Daemon"
  if [ -e $PIDFILE ]; then
    echo "Wicd appears to already be running."
    echo "If this is not the case, then remove "
    echo "$PIDFILE and try again..."
    stat_fail
  else
    %SBIN%wicd 2>/dev/null 1>&2
    add_daemon wicd
    stat_done
  fi
}

wicd_stop() {
  stat_busy "Stopping wicd Daemon"
  if [ -e $PIDFILE ]; then
    kill $(cat $PIDFILE) 2>/dev/null
    rm -f $PIDFILE 2>/dev/null
  fi
  rm_daemon wicd
  stat_done
}

case "$1" in
  start)
    wicd_start
    ;;
  stop)
    wicd_stop
    ;;
  restart)
    $0 stop
    sleep 1
    $0 start
    ;;
  *)
    echo "usage: $0 {start|stop|restart}"  
esac
exit 0


