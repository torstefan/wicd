From: David Paleino <dapal@debian.org>
Subject: implement a -t/--tray switch to only run the tray icon
Forwarded: no

---
 gtk/wicd-client.py      |   18 ++++++++++++------
 other/wicd-tray.desktop |    2 +-
 2 files changed, 13 insertions(+), 7 deletions(-)

--- wicd.orig/gtk/wicd-client.py
+++ wicd/gtk/wicd-client.py
@@ -913,6 +913,7 @@ wicd %s
 wireless (and wired) connection daemon front-end.
 
 Arguments:
+\t-t\t--tray\tRun the wicd tray icon only.
 \t-n\t--no-tray\tRun wicd without the tray icon.
 \t-h\t--help\t\tPrint this help information.
 \t-a\t--no-animate\tRun the tray without network traffic tray animations.
@@ -974,7 +975,8 @@ def main(argv):
 
     """
     try:
-        opts, args = getopt.getopt(sys.argv[1:], 'nhao', ['help', 'no-tray',
+        opts, args = getopt.getopt(sys.argv[1:], 'tnhao', ['help', 'no-tray',
+                                                         'tray',
                                                          'no-animate',
                                                          'only-notifications'])
     except getopt.GetoptError:
@@ -989,6 +991,9 @@ def main(argv):
         if opt in ('-h', '--help'):
             usage()
             sys.exit(0)
+        elif opt in ('-t', '--tray'):
+            use_tray = True
+            display_app = False
         elif opt in ('-n', '--no-tray'):
             use_tray = False
         elif opt in ('-a', '--no-animate'):
@@ -1005,14 +1010,15 @@ def main(argv):
     setup_dbus()
     atexit.register(on_exit)
     
-    if display_app and not use_tray or not ICON_AVAIL:
+    if display_app:
         the_gui = gui.appGui(standalone=True)
-        mainloop = gobject.MainLoop()
-        mainloop.run()
-        sys.exit(0)
+        if not use_tray or not ICON_AVAIL:
+            mainloop = gobject.MainLoop()
+            mainloop.run()
+            sys.exit(0)
 
     # Set up the tray icon GUI and backend
-    tray_icon = TrayIcon(animate, displaytray=display_app)
+    tray_icon = TrayIcon(animate, displaytray=use_tray)
 
     # Check to see if wired profile chooser was called before icon
     # was launched (typically happens on startup or daemon restart).
--- wicd.orig/other/wicd-tray.desktop
+++ wicd/other/wicd-tray.desktop
@@ -1,6 +1,6 @@
 [Desktop Entry]
 Categories=Application;Network;
-Exec=wicd-gtk
+Exec=wicd-gtk --tray
 GenericName=Network Manager
 Icon=wicd-gtk
 Icon[en_US]=wicd-gtk
